<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Vedic Architect – responsive chart</title>
    <style>
        :root { --gold: #f4b400; --red: #d32f2f; --border: #333; --bg: #f8f9fa; }
        body { 
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
            background: var(--bg); 
            margin: 0; 
            min-height: 100vh;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: flex-start;
        }

        .header { 
            padding: 16px 12px; 
            text-align: center; 
            width: 100%;
            box-sizing: border-box;
        }
        .header h1 { font-size: 1.6rem; margin: 0 0 4px; }
        .header p { margin: 6px 0 0; font-size: 0.95rem; color: #555; }

        .main { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 24px; 
            padding: 10px 12px 24px; 
            width: 100%;
            max-width: 700px;  /* comfortable reading width on tablets */
            margin: 0 auto;
            box-sizing: border-box;
        }

        /* chart container – auto scales with viewport */
        .chart-container { 
            position: relative; 
            background: white; 
            padding: 8px; 
            border-radius: 20px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); 
            width: 100%;
            display: flex;
            justify-content: center;
        }

        svg { 
            display: block; 
            width: 100%; 
            height: auto; 
            max-width: 500px;   /* original comfortable size, but will shrink on mobile */
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        /* house polygons */
        .house { fill: #fff; stroke: var(--border); stroke-width: 1.5; transition: fill 0.2s; }
        .house:hover { fill: #fffdf0; }
        .house.active { fill: #fff9c4; stroke-width: 3; }

        /* Text sizes adjust slightly via viewport scaling, but svg keeps proportions */
        .house-num { fill: #bbb; font-size: 13px; pointer-events: none; }
        .zodiac-num { fill: #444; font-size: 15px; font-weight: bold; pointer-events: none; }
        .planet-tag { fill: var(--red); font-size: 13px; font-weight: 700; cursor: pointer; user-select: none; }

        /* planet bank – wraps nicely on mobile */
        #planet-bank { 
            background: white; 
            padding: 16px 12px; 
            border-radius: 40px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); 
            width: fit-content; 
            max-width: 95%;
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 10px; 
            margin: 5px 0 5px;
            box-sizing: border-box;
        }
        .planet-item { 
            padding: 10px 18px; 
            background: var(--gold); 
            color: white; 
            border-radius: 40px; 
            cursor: grab; 
            text-align: center; 
            font-weight: 600; 
            font-size: 1rem;
            min-width: 50px; 
            transition: all 0.2s; 
            touch-action: none; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            -webkit-tap-highlight-color: transparent;
        }
        .planet-item.in-use { opacity: 0.3; pointer-events: none; transform: scale(0.9); background: #aaa; }
        .planet-item.lagna-planet { background: #9c27b0; }  /* purple */

        .controls { 
            margin-top: 8px; 
            display: flex; 
            gap: 15px; 
            justify-content: center; 
            flex-wrap: wrap;
        }
        button { 
            padding: 12px 28px; 
            border: none; 
            border-radius: 60px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 1rem;
            transition: 0.2s; 
            background: #eee; 
            color: #333;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        button:hover { background: #ddd; }
        .btn-clear { background: #eee; }

        /* small extra spacing */
        @media (max-width: 480px) {
            .header h1 { font-size: 1.4rem; }
            .planet-item { padding: 8px 14px; min-width: 44px; font-size: 0.9rem; }
            button { padding: 10px 20px; }
            .house-num { font-size: 11px; }
            .zodiac-num { font-size: 13px; }
            .planet-tag { font-size: 12px; }
        }
    </style>
</head>
<body>

<div class="header">
    <h1>Vedic Architect – Lagna as planet</h1>
    <p>Drag short forms (Su, Mo..). <strong>La</strong> sets the Ascendant: drop it onto a house → that house becomes House 1.</p>
</div>

<div class="main">
    <!-- chart container: svg scales with width, stays centered -->
    <div class="chart-container">
        <svg id="chart" width="500" height="500" viewBox="0 0 500 500" preserveAspectRatio="xMidYMid meet">
            <g id="houses-group"></g>
            <g id="labels-group"></g>
            <g id="planets-group"></g>
        </svg>
    </div>

    <!-- planet bank -->
    <div id="planet-bank"></div>

    <!-- controls -->
    <div class="controls">
        <button class="btn-clear" onclick="resetChart()">Reset Everything</button>
    </div>
</div>

<script>
/** 1. DATA & CONSTANTS – using SHORT names **/
const PLANETS = [
    { full: "Sun", short: "Su" },
    { full: "Moon", short: "Mo" },
    { full: "Mars", short: "Ma" },
    { full: "Mercury", short: "Me" },
    { full: "Jupiter", short: "Ju" },
    { full: "Venus", short: "Ve" },
    { full: "Saturn", short: "Sa" },
    { full: "Rahu", short: "Ra" },
    { full: "Ketu", short: "Ke" },
    { full: "Lagna", short: "La" }   // Lagna as a movable planet
];

const HOUSE_PATHS = [
    { id: 1,  p: "250,250 125,125 250,0 375,125",   c: [250, 110], z: [250, 30] },
    { id: 2,  p: "125,125 250,0 0,0",               c: [130, 60],  z: [50, 20]  },
    { id: 3,  p: "125,125 0,250 0,0",               c: [60, 130],  z: [20, 50]  },
    { id: 4,  p: "250,250 125,125 0,250 125,375",   c: [110, 250], z: [30, 250] },
    { id: 5,  p: "125,375 0,250 0,500",             c: [60, 370],  z: [20, 450] },
    { id: 6,  p: "125,375 250,500 0,500",           c: [130, 440], z: [50, 480] },
    { id: 7,  p: "250,250 125,375 250,500 375,375", c: [250, 390], z: [250, 470]},
    { id: 8,  p: "375,375 250,500 500,500",         c: [370, 440], z: [450, 480]},
    { id: 9,  p: "375,375 500,250 500,500",         c: [440, 370], z: [480, 450]},
    { id: 10, p: "250,250 375,125 500,250 375,375", c: [390, 250], z: [470, 250]},
    { id: 11, p: "375,125 500,0 500,250",           c: [440, 130], z: [480, 50] },
    { id: 12, p: "375,125 250,0 500,0",             c: [370, 60],  z: [450, 20] }
];

/** 2. STATE MANAGEMENT **/
let state = {
    placements: { "Lagna": 1 }   // La starts in house 1
};

let draggedPlanet = null;

/** 3. CORE FUNCTIONS **/
function init() {
    renderPlanetBank();
    renderHouses();
    renderChart();
}

function renderPlanetBank() {
    const container = document.getElementById('planet-bank');
    container.innerHTML = PLANETS.map(p => {
        const fullName = p.full;
        const isLagna = (fullName === "Lagna");
        const inUse = state.placements[fullName] !== undefined;
        return `
            <div class="planet-item ${inUse ? 'in-use' : ''} ${isLagna ? 'lagna-planet' : ''}" 
                 id="bank-${fullName}" draggable="true" ondragstart="onDragStart('${fullName}')">
                ${p.short}
            </div>
        `;
    }).join('');
}

function renderHouses() {
    const group = document.getElementById('houses-group');
    group.innerHTML = HOUSE_PATHS.map(h => `
        <polygon id="house-${h.id}" points="${h.p}" class="house" 
                 ondragover="event.preventDefault()" 
                 ondrop="onDrop(event, ${h.id})"></polygon>
    `).join('');
}

function renderChart() {
    const labelGroup = document.getElementById('labels-group');
    const planetGroup = document.getElementById('planets-group');
    labelGroup.innerHTML = '';
    planetGroup.innerHTML = '';

    // Determine lagna house: where is "Lagna" placed?
    const lagnaHouse = state.placements["Lagna"] || 1;

    HOUSE_PATHS.forEach(h => {
        const houseId = h.id;
        let displayHouseNum = ((houseId - lagnaHouse + 12) % 12) + 1;
        const sign = displayHouseNum;  // zodiac sign number
        
        // Render Zodiac number
        const zNode = createSVGText(h.z[0], h.z[1], sign, 'zodiac-num');
        labelGroup.appendChild(zNode);

        // Render House Number as H + displayHouseNum
        const hNode = createSVGText(h.c[0], h.c[1] - 30, `H${displayHouseNum}`, 'house-num');
        labelGroup.appendChild(hNode);

        // Planets in this physical house
        const planetsInThisHouse = Object.keys(state.placements).filter(p => state.placements[p] === houseId);
        
        planetsInThisHouse.forEach((fullP, i) => {
            const planetObj = PLANETS.find(pl => pl.full === fullP);
            const shortName = planetObj ? planetObj.short : fullP.substring(0,2);
            
            const pNode = createSVGText(h.c[0], h.c[1] + (i * 18), shortName, 'planet-tag');
            pNode.onclick = () => removePlanet(fullP);
            // Re-drag capability
            pNode.setAttribute('draggable', 'true');
            pNode.ondragstart = (e) => {
                e.stopPropagation();
                onDragStart(fullP);
            };
            planetGroup.appendChild(pNode);
        });
    });
}

/** 4. INTERACTION LOGIC **/
function onDragStart(p) { 
    draggedPlanet = p; 
}

function onDrop(e, houseId) {
    e.preventDefault();
    if (!draggedPlanet) return;

    // assign dragged planet to new house
    state.placements[draggedPlanet] = houseId;
    
    draggedPlanet = null;
    sync();
}

function removePlanet(p) {
    // Prevent removal of Lagna – Lagna must always exist in chart
    if (p === "Lagna") {
        alert("Lagna (La) cannot be removed. Drag it to another house to change ascendant.");
        return;
    }
    delete state.placements[p];
    sync();
}

function resetChart() {
    state.placements = { "Lagna": 1 };
    sync();
}

function sync() {
    renderPlanetBank();
    renderChart();
}

/** 5. UTILS **/
function createSVGText(x, y, txt, cls) {
    const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
    t.setAttribute("x", x);
    t.setAttribute("y", y);
    t.setAttribute("class", cls);
    t.setAttribute("text-anchor", "middle");
    t.textContent = txt;
    return t;
}

// make functions global for inline event handlers
window.onDragStart = onDragStart;
window.onDrop = onDrop;
window.removePlanet = removePlanet;
window.resetChart = resetChart;

init();
</script>
</body>
</html>
